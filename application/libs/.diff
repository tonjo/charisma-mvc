176a177,180
>         if (ACCESS_LOG_ENABLED && isset($_SESSION['log_id']))
>             $log_id = $_SESSION['log_id'];
>         else $log_id = 0;
> 
180a185,194
> 
>         if ($log_id) {
>             if (! $this->createDatabaseConnection())
>                 return;
>             $sql = "UPDATE log set last_logout = datetime('now') WHERE id = :log_id";
>             $query = $this->db_connection->prepare($sql);
>             $query->bindValue(':log_id',$log_id);
>             $query->execute(); // Not caring errors, not giving feedback
>             unset($_SESSION['log_id']);
>         }
230c244
<             $this->feedback = "Empty or invalid users table";
---
>             $this->feedback = "Tabella utenti inesistente";
254c268
<                 $this->feedback = "Wrong password.";
---
>                 $this->feedback = "Password errata";
257c271
<             $this->feedback = "This user does not exist.";
---
>             $this->feedback = "Utente inesistente";
269c283,295
<         return $this->checkPassword($_POST['user_name'],$_POST['user_password']);
---
>         $oklogin = $this->checkPassword($_POST['user_name'],$_POST['user_password']);
>         if (ACCESS_LOG_ENABLED && $oklogin) {
>             $sql = "INSERT INTO log (user_email,from_ip) VALUES (:user_email,:from_ip)";
>             $query = $this->db_connection->prepare($sql);
>             $query->bindValue(':user_email',$_SESSION['user_email']);
>             if (isset($_SERVER['REMOTE_ADDR']))
>                 $remote = $_SERVER['REMOTE_ADDR'];
>             else $remote = '';
>             $query->bindValue(':from_ip',$remote);
>             $query->execute();
>             $_SESSION['log_id'] = $this->db_connection->lastInsertId();
>         }
>         return $oklogin;
388c414
<         $this->createNewUser_common($username,$email,$password,$rank);
---
>         return $this->createNewUser_common($username,$email,$password,$rank);
